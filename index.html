<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, minimum-scale=0.5, maximum-scale=5.0, viewport-fit=cover"
    />
    <title>Food Chain TCG Prototype</title>
    <link rel="stylesheet" href="styles.css?v=2.0" />
    <link
      href="https://fonts.googleapis.com/css2?family=Barlow:wght@400;500;600&family=Bebas+Neue&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <div class="overlay deck-select-overlay" id="deck-select-overlay" aria-hidden="true">
      <div class="overlay-content deck-select-card">
        <div class="deck-select-header">
          <div class="deck-select-icon">üÉè</div>
          <div>
            <h2 id="deck-select-title">Player 1 Deck Selection</h2>
            <p id="deck-select-subtitle">Choose the animal category for Player 1.</p>
          </div>
        </div>
        <div class="deck-select-grid" id="deck-select-grid"></div>
      </div>
    </div>

    <div class="overlay deck-overlay" id="deck-overlay" aria-hidden="true">
      <div class="overlay-content deck-builder">
        <div class="deck-header">
          <h2 id="deck-title">Deck Builder</h2>
          <div class="deck-status" id="deck-status"></div>
        </div>
        <div class="deck-tabs">
          <button class="deck-tab active" data-tab="catalog">Catalog</button>
          <button class="deck-tab" data-tab="deck">My Deck</button>
          <button class="deck-tab" data-tab="load">Load Deck</button>
          <button class="deck-tab" data-tab="manage">Manage Decks</button>
        </div>
        <div class="deck-content">
          <div class="deck-panel deck-catalog-panel active">
            <div class="deck-grid" id="deck-full-row"></div>
          </div>
          <div class="deck-panel deck-added-panel">
            <div class="deck-grid" id="deck-added-row"></div>
          </div>
          <div class="deck-panel deck-load-panel">
            <div class="deck-load-list" id="deck-load-list"></div>
          </div>
          <div class="deck-panel deck-manage-panel">
            <div class="deck-manage-list" id="deck-manage-list"></div>
          </div>
        </div>
        <div class="deck-inspector" id="deck-inspector-panel"></div>
        <div class="deck-actions">
          <button class="deck-exit" id="deck-exit" type="button">Back</button>
          <button class="deck-save" id="deck-save" type="button">Save Deck</button>
          <button class="deck-random" id="deck-random" type="button">Random</button>
          <button class="deck-load" id="deck-load" type="button">Load Deck</button>
          <button class="btn-primary" id="deck-confirm" type="button">Confirm Deck</button>
        </div>
      </div>
    </div>

    <div class="overlay setup-overlay" id="setup-overlay" aria-hidden="true">
      <div class="overlay-content setup-card">
        <div class="setup-icon">üé≤</div>
        <h2 id="setup-title">Opening Roll</h2>
        <p id="setup-subtitle">Each player rolls a d10 to decide who chooses first.</p>
        <div class="setup-rolls" id="setup-rolls"></div>
        <div class="setup-actions" id="setup-actions"></div>
      </div>
    </div>

    <div class="overlay pass-overlay" id="pass-overlay" aria-hidden="true">
      <div class="overlay-content pass-card">
        <div class="pass-icon">üîÑ</div>
        <h2 id="pass-title">Pass to Player 2</h2>
        <p>Hand the device to the next player, then tap OK when ready.</p>
        <button class="btn-primary" id="pass-confirm">OK</button>
      </div>
    </div>

    <div class="overlay menu-overlay" id="menu-overlay" aria-hidden="true">
      <div class="overlay-content menu-card">
        <div class="menu-header">
          <div class="menu-icon">üçΩÔ∏è</div>
          <div>
            <h2>Food Chain TCG</h2>
            <p class="muted">Choose how you want to play.</p>
          </div>
        </div>
        <div class="menu-status" id="menu-status"></div>
        <div class="menu-actions">
          <button class="btn-primary" id="menu-play">Play (one device)</button>
          <button class="btn-primary" id="menu-ai">Play vs. AI</button>
          <button class="btn-secondary" id="menu-login">Login</button>
          <button class="btn-secondary" id="menu-catalog" disabled>Catalog</button>
          <button class="btn-secondary" id="menu-tutorial">Tutorial</button>
        </div>
      </div>
    </div>

    <div class="overlay tutorial-overlay" id="tutorial-overlay" aria-hidden="true">
      <div class="overlay-content tutorial-card">
        <div class="tutorial-header">
          <div>
            <p class="tutorial-eyebrow">Rules &amp; Reference</p>
            <h2>Food Chain‚Ñ¢ TCG Tutorial</h2>
            <p class="muted">
              A living rules guide from basics to advanced interactions. Scroll to explore.
            </p>
          </div>
          <button class="btn-secondary" id="tutorial-close" type="button">Back</button>
        </div>
        <div class="tutorial-scroll">
          <section class="tutorial-section">
            <h3>1) The Goal</h3>
            <p>
              Reduce your rival from <strong>10 HP</strong> to <strong>0 HP</strong> using creatures,
              spells, and clever consumption combos.
            </p>
            <div class="tutorial-diagram focus-diagram">
              <div class="focus-card">
                <div class="focus-card-title">Rival HP</div>
                <div class="focus-card-value stat-pulse">10 ‚Üí 0</div>
                <div class="focus-card-caption">Win when it hits zero.</div>
              </div>
              <div class="focus-arrow">‚ûú</div>
              <div class="focus-card">
                <div class="focus-card-title">Your Creatures</div>
                <div class="focus-card-value">ATK pushes damage</div>
                <div class="focus-card-caption">Attack directly or remove defenders.</div>
              </div>
            </div>
          </section>

          <section class="tutorial-section">
            <h3>2) Card Anatomy</h3>
            <p>
              Creatures have <strong>ATK</strong> (damage dealt), <strong>HP</strong> (how much they can
              take), and prey have <strong>NUT</strong> (nutrition for predators).
            </p>
            <div class="tutorial-diagram card-anatomy">
              <div class="stat-card">
                <div class="stat-row">
                  <span class="stat-label">ATK</span>
                  <span class="stat-value stat-pulse">3</span>
                </div>
                <div class="stat-row">
                  <span class="stat-label">HP</span>
                  <span class="stat-value stat-pulse">2</span>
                </div>
                <div class="stat-row">
                  <span class="stat-label">NUT</span>
                  <span class="stat-value stat-pulse">1</span>
                </div>
                <div class="stat-footer">Prey Example</div>
              </div>
              <div class="stat-explain">
                <p>
                  <strong>ATK</strong> = damage in combat.<br />
                  <strong>HP</strong> = survivability (think defense).<br />
                  <strong>NUT</strong> = how much power predators gain when consuming.
                </p>
              </div>
            </div>
          </section>

          <section class="tutorial-section">
            <h3>3) Board Zones</h3>
            <div class="tutorial-diagram zone-diagram">
              <div class="zone-block">
                <h4>Hand</h4>
                <p>Private cards. No size limit.</p>
              </div>
              <div class="zone-block">
                <h4>Field (Max 3)</h4>
                <p>Creatures &amp; field spells. Where combat happens.</p>
              </div>
              <div class="zone-block">
                <h4>Carrion / Exile</h4>
                <p>Destroyed creatures ‚Üí carrion. Used spells ‚Üí exile.</p>
              </div>
            </div>
          </section>

          <section class="tutorial-section">
            <h3>4) Turn Flow (Start ‚Üí End)</h3>
            <div class="tutorial-diagram turn-flow">
              <div class="flow-step">Start Phase</div>
              <div class="flow-arrow">‚ûú</div>
              <div class="flow-step">Draw Phase</div>
              <div class="flow-arrow">‚ûú</div>
              <div class="flow-step">Main 1 (Play 1)</div>
              <div class="flow-arrow">‚ûú</div>
              <div class="flow-step">Before Combat</div>
              <div class="flow-arrow">‚ûú</div>
              <div class="flow-step">Combat</div>
              <div class="flow-arrow">‚ûú</div>
              <div class="flow-step">Main 2 (if none)</div>
              <div class="flow-arrow">‚ûú</div>
              <div class="flow-step">End Phase</div>
            </div>
            <p class="tutorial-note">
              Only <strong>one</strong> non-free-spell card can be played per turn across both main
              phases.
            </p>
          </section>

          <section class="tutorial-section">
            <h3>5) Combat Quick View</h3>
            <div class="tutorial-diagram combat-diagram">
              <div class="combat-card">
                <div class="combat-title">Attacker</div>
                <div class="combat-stats">ATK 3 / HP 2</div>
              </div>
              <div class="combat-connector">‚öîÔ∏è</div>
              <div class="combat-card">
                <div class="combat-title">Defender</div>
                <div class="combat-stats">ATK 2 / HP 3</div>
              </div>
              <div class="combat-result">
                Both deal damage simultaneously. HP ‚â§ 0 goes to carrion.
              </div>
            </div>
          </section>

          <section class="tutorial-section">
            <h3>6) Consumption System</h3>
            <p>
              Predators may consume <strong>0-3</strong> friendly prey (or edible predators) when played.
              Each nutrition point grants <strong>+1 ATK/+1 HP</strong> and activates the predator‚Äôs
              consume effect.
            </p>
            <div class="tutorial-diagram consume-diagram">
              <div class="consume-prey">Prey (NUT 2)</div>
              <div class="flow-arrow">‚ûú</div>
              <div class="consume-prey">Prey (NUT 1)</div>
              <div class="flow-arrow">‚ûú</div>
              <div class="consume-predator">
                Predator enters<br />
                +3 ATK / +3 HP
              </div>
            </div>
            <p class="tutorial-note">
              Dry drop = play a predator without consuming. Effect does not trigger.
            </p>
          </section>

          <section class="tutorial-section">
            <h3>7) Spells, Free Spells, Traps</h3>
            <div class="tutorial-diagram spell-diagram">
              <div class="spell-card">
                <h4>Spell</h4>
                <p>Counts toward the 1-card-per-turn limit.</p>
              </div>
              <div class="spell-card">
                <h4>Free Spell</h4>
                <p>Does not count toward the limit.</p>
              </div>
              <div class="spell-card">
                <h4>Trap</h4>
                <p>Set in main phase, triggers on opponent‚Äôs turn.</p>
              </div>
            </div>
          </section>

          <section class="tutorial-section">
            <h3>8) Advanced Mechanics Highlights</h3>
            <ul class="tutorial-list">
              <li><strong>Summoning Exhaustion:</strong> Can‚Äôt attack rival directly until next turn.</li>
              <li><strong>Barrier:</strong> Prevents the first damage instance, then breaks.</li>
              <li><strong>Frozen:</strong> Can‚Äôt attack or be consumed; dies at end of controller‚Äôs turn.</li>
              <li><strong>Slain:</strong> Only triggers when dying in combat vs a creature.</li>
              <li><strong>Scavenge:</strong> May consume from carrion pile when played.</li>
              <li><strong>Discard:</strong> Some cards can be discarded for alternate effects.</li>
            </ul>
          </section>

          <section class="tutorial-section">
            <h3>9) Keyword Glossary</h3>
            <div class="tutorial-grid">
              <div><strong>Haste</strong> ‚Äî Can attack rival directly on the turn it is played.</div>
              <div><strong>Free Play</strong> ‚Äî Doesn‚Äôt count toward the one-card limit.</div>
              <div><strong>Hidden</strong> ‚Äî Can‚Äôt be targeted by attacks.</div>
              <div><strong>Invisible</strong> ‚Äî Can‚Äôt be targeted by attacks or spells.</div>
              <div><strong>Lure</strong> ‚Äî Must be attacked if able.</div>
              <div><strong>Immune</strong> ‚Äî Only takes damage from direct creature attacks.</div>
              <div><strong>Barrier</strong> ‚Äî Blocks first instance of damage.</div>
              <div><strong>Passive</strong> ‚Äî Cannot attack.</div>
              <div><strong>Edible</strong> ‚Äî Predator can be consumed as nutrition.</div>
              <div><strong>Scavenge</strong> ‚Äî Can consume from carrion pile.</div>
              <div><strong>Acuity</strong> ‚Äî Can target hidden/invisible creatures.</div>
              <div><strong>Neurotoxic</strong> ‚Äî Combat damage freezes target until it dies.</div>
              <div><strong>Ambush</strong> ‚Äî Reserved for future implementation.</div>
              <div><strong>Frozen</strong> ‚Äî Cannot attack or be consumed; dies end of turn.</div>
            </div>
          </section>

          <section class="tutorial-section">
            <h3>10) Effect &amp; Timing Glossary</h3>
            <div class="tutorial-grid">
              <div><strong>On Play</strong> ‚Äî Triggers when the card is played to the field.</div>
              <div><strong>On Consume</strong> ‚Äî Triggers when a predator consumes at least 1 target.</div>
              <div><strong>Before Combat</strong> ‚Äî Fires between Main 1 and Combat.</div>
              <div><strong>When Defending</strong> ‚Äî Fires when chosen as an attack target.</div>
              <div><strong>Start of Turn</strong> ‚Äî Triggers before the draw phase.</div>
              <div><strong>End of Turn</strong> ‚Äî Triggers before turn passes.</div>
              <div><strong>Kill</strong> ‚Äî Instantly destroys target regardless of HP.</div>
              <div><strong>Play/Summon</strong> ‚Äî Creates a token without on-play triggers.</div>
            </div>
          </section>

          <section class="tutorial-section">
            <h3>11) Quick Reference: Card Limit</h3>
            <p>
              One non-free-spell card per turn across both main phases. Free spells are unlimited in
              the main phases.
            </p>
          </section>
        </div>
      </div>
    </div>

    <div class="overlay login-overlay" id="login-overlay" aria-hidden="true">
      <div class="overlay-content menu-card login-card">
        <div class="menu-header">
          <div class="menu-icon">üîê</div>
          <div>
            <h2>Quick Login</h2>
            <p class="muted">Enter a username to save decks and join lobbies.</p>
          </div>
        </div>
        <form class="menu-form" id="login-form">
          <label class="menu-label" for="login-username">Username</label>
          <input
            class="menu-input"
            id="login-username"
            name="username"
            autocomplete="username"
            placeholder="e.g. KrakenQueen"
            required
          />
          <div class="menu-error" id="login-error" role="alert"></div>
          <div class="menu-actions">
            <button class="btn-primary" type="submit" id="login-submit">Continue</button>
            <button class="btn-secondary" type="button" id="login-cancel">Back</button>
          </div>
        </form>
      </div>
    </div>

    <div class="overlay multiplayer-overlay" id="multiplayer-overlay" aria-hidden="true">
      <div class="overlay-content menu-card">
        <div class="menu-header">
          <div class="menu-icon">üåê</div>
          <div>
            <h2>Multiplayer</h2>
            <p class="muted" id="multiplayer-status">Create or join a lobby with a friend.</p>
          </div>
        </div>
        <div class="lobby-code" id="lobby-code-display">----</div>
        <div class="menu-actions" id="multiplayer-actions">
          <button class="btn-primary" id="lobby-find-match">Find Match</button>
          <button class="btn-secondary" id="lobby-find-cancel" style="display: none;">Cancel</button>
          <button class="btn-primary" id="lobby-create">Create Lobby</button>
          <button class="btn-primary" id="lobby-rejoin" style="display: none;">Rejoin Lobby</button>
          <button class="btn-primary" id="lobby-continue" style="display: none;">Continue to Game</button>
          <button class="btn-secondary" id="lobby-join">Join as Guest</button>
          <button class="btn-secondary" id="lobby-leave" style="display: none;">New Code</button>
          <button class="btn-secondary" id="multiplayer-back">Back</button>
        </div>
        <form class="menu-form" id="lobby-join-form">
          <label class="menu-label" for="lobby-code">Enter Lobby Code</label>
          <input
            class="menu-input"
            id="lobby-code"
            name="code"
            autocomplete="off"
            placeholder="ABC123"
          />
          <div class="menu-actions">
            <button class="btn-primary" type="submit">Join</button>
            <button class="btn-secondary" type="button" id="lobby-join-cancel">Cancel</button>
          </div>
        </form>
        <div class="menu-error" id="lobby-error" role="alert"></div>
      </div>
    </div>

    <div class="overlay ai-setup-overlay" id="ai-setup-overlay" aria-hidden="true">
      <div class="overlay-content menu-card">
        <div class="menu-header">
          <div class="menu-icon">ü§ñ</div>
          <div>
            <h2>Play vs. AI</h2>
            <p class="muted">Choose difficulty and decks for your match.</p>
          </div>
        </div>

        <div class="ai-setup-section" id="ai-difficulty-section">
          <h3 class="ai-setup-label">Difficulty</h3>
          <div class="ai-difficulty-buttons">
            <button class="btn-difficulty active" id="ai-difficulty-easy" data-difficulty="easy">
              <span class="difficulty-icon">üêü</span>
              <span class="difficulty-name">Easy</span>
              <span class="difficulty-desc">Simple decisions, less aggressive</span>
            </button>
            <button class="btn-difficulty" id="ai-difficulty-hard" data-difficulty="hard">
              <span class="difficulty-icon">ü¶à</span>
              <span class="difficulty-name">Hard</span>
              <span class="difficulty-desc">Knows your hand, optimal plays</span>
            </button>
          </div>
        </div>

        <div class="ai-setup-section" id="ai-deck-section">
          <h3 class="ai-setup-label">AI Deck</h3>
          <div class="ai-deck-options">
            <button class="btn-deck-option active" id="ai-deck-random" data-deck="random">
              <span class="deck-option-icon">üé≤</span>
              <span class="deck-option-name">Random Deck</span>
            </button>
            <button class="btn-deck-option" id="ai-deck-saved" data-deck="saved">
              <span class="deck-option-icon">üìö</span>
              <span class="deck-option-name">Use Saved Deck</span>
            </button>
          </div>
          <div class="ai-saved-decks" id="ai-saved-decks" style="display: none;">
            <select class="menu-select" id="ai-deck-select">
              <option value="">Select a deck...</option>
            </select>
          </div>
        </div>

        <div class="menu-actions">
          <button class="btn-primary" id="ai-start-game">Start Game</button>
          <button class="btn-secondary" id="ai-setup-back">Back</button>
        </div>
      </div>
    </div>

    <div class="overlay victory-overlay" id="victory-overlay" aria-hidden="true">
      <div class="victory-container">
        <div class="victory-background">
          <div class="victory-particles"></div>
          <div class="victory-rays"></div>
        </div>
        <div class="victory-content">
          <div class="victory-crown">üëë</div>
          <h1 class="victory-title">VICTORY</h1>
          <div class="victory-winner" id="victory-winner-name">Player Name</div>
          <div class="victory-subtitle">has conquered the Food Chain!</div>
          <div class="victory-stats">
            <div class="stat-item">
              <span class="stat-label">Turns</span>
              <span class="stat-value" id="victory-turns">0</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Cards Played</span>
              <span class="stat-value" id="victory-cards">0</span>
            </div>
            <div class="stat-item">
              <span class="stat-label">Enemies Defeated</span>
              <span class="stat-value" id="victory-kills">0</span>
            </div>
          </div>
          <div class="victory-actions">
            <button class="btn-primary victory-menu" id="victory-menu">Main Menu</button>
          </div>
        </div>
      </div>
    </div>

    <div class="game-container">
      <header class="top-bar">
        <div class="player-badge player-left" data-player-index="0">
          <div class="player-info">
            <span class="player-name" id="player1-name">Player 1</span>
            <div class="player-stats">
              <span id="player1-hp">HP: 10</span>
              <span id="player1-deck">Deck: 20</span>
            </div>
          </div>
        </div>
        <button class="turn-badge" id="turn-badge" type="button" aria-label="Advance phase">
          <span class="turn-number" id="turn-number">Turn 1</span>
          <span class="phase-label" id="phase-label">Main</span>
        </button>
        <div class="player-badge player-right" data-player-index="1">
          <div class="player-info right">
            <span class="player-name" id="player2-name">Player 2</span>
            <div class="player-stats">
              <span id="player2-hp">HP: 10</span>
              <span id="player2-deck">Deck: 20</span>
            </div>
          </div>
        </div>
      </header>

      <div class="pages-container" id="pages-container">
        <section class="page page-battlefield active" data-page="0">
          <div class="battlefield-layout-three-column">
            <!-- Left Column: Card Inspector -->
            <div class="battlefield-left-column">
              <div class="card-inspector-panel">
                <div class="inspector-header">
                  <h3>Card Inspector</h3>
                </div>
                <div class="inspector-content" id="card-inspector">
                  <div class="inspector-placeholder">
                    <p>Click on a card to see details</p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Center Column: Battlefield and Hand -->
            <div class="battlefield-center-column">
              <div class="battlefield-layout">
                <div class="battlefield-region">
                  <div class="battlefield">
                    <div class="field-row opponent-field">
                      <div class="field-slot" data-slot="0"></div>
                      <div class="field-slot" data-slot="1"></div>
                      <div class="field-slot" data-slot="2"></div>
                    </div>
                    <div class="field-divider">
                      <button class="mobile-nav-left" id="mobile-nav-left" aria-label="View Card Inspector">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                          <polyline points="15 18 9 12 15 6"></polyline>
                        </svg>
                      </button>
                      <p class="field-divider-text">
                        Food Chain‚Ñ¢ (C) Food Chain TCG. All rights reserved.
                      </p>
                      <button class="mobile-nav-right" id="mobile-nav-right" aria-label="View Game History">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                          <polyline points="9 18 15 12 9 6"></polyline>
                        </svg>
                      </button>
                    </div>
                    <div class="field-row player-field">
                      <div class="field-slot" data-slot="0"></div>
                      <div class="field-slot" data-slot="1"></div>
                      <div class="field-slot" data-slot="2"></div>
                    </div>
                  </div>
                  <div class="battle-effects" id="battle-effects" aria-hidden="true"></div>
                </div>
                <div class="hand-panel">
                  <div class="hand-container">
                    <div class="hand-header">
                      <h3 class="hand-title">Your Hand</h3>
                    </div>
                    <div class="hand-grid" id="active-hand"></div>
                  </div>
                </div>
              </div>
              <!-- Action Bar constrained to center column -->
              <footer class="action-bar" id="action-bar">
                <div class="selection-panel" id="selection-panel"></div>
                <div class="action-panel" id="action-panel"></div>
              </footer>
            </div>

            <!-- Right Column: Game History Log -->
            <div class="battlefield-right-column">
              <div class="game-log-panel">
                <div class="log-header">
                  <h3>Game History</h3>
                </div>
                <div class="log-content" id="game-history-log">
                  <!-- Game log entries will be populated here -->
                </div>
              </div>
              <!-- Piles Information - anchored to bottom -->
              <div class="piles-section">
                <div class="piles-grid">
                  <div class="pile-item">
                    <span>Carrion</span>
                    <strong id="active-carrion">0</strong>
                  </div>
                  <div class="pile-item">
                    <span>Exile</span>
                    <strong id="active-exile">0</strong>
                  </div>
                  <div class="pile-item">
                    <span>Traps</span>
                    <strong id="active-traps">0</strong>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>
      </div>

    <script type="module" src="js/main.js"></script>
  </body>
</html>
